# 淘宝/天猫自动抢单工具

这是一个基于 Python 和 Selenium 实现的淘宝/天猫自动抢单工具，通过识别和点击网页上的按钮，实现自动化抢购商品的功能。

## 功能特性

- 使用 CSS 选择器识别抢购按钮，更好地防止被反爬虫机制检测
- 支持设定精确抢单时间，精确到毫秒
- 提供可自定义的按钮 CSS 选择器列表
- 反复尝试点击，最大化抢购成功率
- 浏览器不会自动关闭，方便检查抢购结果
- **保存登录状态，避免每次运行都需要手动登录**
- **新功能：NTP 时间同步，精准毫秒级校准**
- **新功能：智能刷新和并行点击策略，提高抢单成功率**

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

### 基本用法

```bash
python main.py --url "https://item.taobao.com/item.htm?id=573515891033"
```

### 高级用法

```bash
python main.py --url "商品URL" --time "YYYY-MM-DD HH:MM:SS.fff" --selectors ".btn1,.btn2,.btn3" --max-attempts 200 --interval 0.05 --network-delay 0.3
```

### 清除保存的登录状态

```bash
python main.py --clear-cookies
```

参数说明:

- `--url`: 商品页面 URL
- `--time`: 抢单时间，格式为 YYYY-MM-DD HH:MM:SS 或 YYYY-MM-DD HH:MM:SS.fff
- `--selectors`: 自定义 CSS 选择器列表，用逗号分隔
- `--max-attempts`: 最大尝试次数
- `--interval`: 重试间隔(秒)
- `--clear-cookies`: 清除保存的登录状态
- `--network-delay`: 网络延迟补偿(秒)，默认 0.3 秒

## 使用步骤

1. 运行程序，浏览器会自动打开商品页面
2. 如果之前已经登录并保存了状态，程序会自动恢复登录状态
3. 如果没有保存的登录状态或状态已失效，需要在浏览器中手动登录
4. 登录完成后，按 Enter 键继续（登录状态将被保存以便下次使用）
5. 程序会自动同步网络时间并精准等待到设定的抢单时间
6. 到达指定时间后，程序使用智能刷新和并行点击策略尝试抢单
7. 检查浏览器中的结果，确认是否抢单成功
8. 手动关闭浏览器或在控制台按 Enter 键退出程序

## 新增功能详细说明

### 时间同步系统

- 使用 NTP 网络时间协议校准本地时钟
- 动态计算网络延迟（可调整）
- 最后 1 秒使用忙等待确保精度

### 智能刷新机制

- 使用 JavaScript 直接刷新跳过缓存
- 每 0.5 秒自动刷新保持页面最新
- 智能等待核心元素加载完成

### 并行点击策略

- 同时检测多个选择器提升成功率
- 使用原生 JavaScript 操作绕过 WebDriver 延迟
- 随机化重试间隔模拟人工操作

## 注意事项

- 本工具仅供学习和研究使用，请勿用于商业用途
- 过度频繁的抢单行为可能导致账户被限制，请合理使用
- 程序不保证 100%抢单成功，成功率受网络环境、服务器负载等多种因素影响
- 使用工具前建议先熟悉相关网站的购物流程
- **登录状态保存在程序同目录下的 cookies.pkl 文件中，请注意保护账户安全**

# qiangdan_tb
